<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Franklin FinTrack</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f0d;
            --bg-card: #131a17;
            --bg-input: #0f1613;
            --green-main: #3ecf8e;
            --green-dim: rgba(62, 207, 142, 0.15);
            --green-glow: rgba(62, 207, 142, 0.35);
            --text-primary: #eef2f0;
            --text-muted: #7a8f85;
            --border: rgba(62, 207, 142, 0.2);
            --red: #e05a5a;
            --red-dim: rgba(224, 90, 90, 0.15);
            --blue: #5aafe8;
            --blue-dim: rgba(90, 175, 232, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            pointer-events: none;
            z-index: 0;
        }
        .orb-1 { width: 500px; height: 500px; background: #2aad72; opacity: 0.1; top: -200px; left: -150px; }
        .orb-2 { width: 350px; height: 350px; background: #1e7a52; opacity: 0.12; bottom: -100px; right: -100px; }
        .orb-3 { width: 250px; height: 250px; background: #3ecf8e; opacity: 0.06; top: 50%; left: 55%; }

        .page-wrap { position: relative; z-index: 1; max-width: 960px; margin: 0 auto; padding: 28px 24px 60px; }

        /* Topbar */
        .topbar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 36px; }
        .logo-wrap { display: flex; align-items: center; gap: 12px; }
        .logo-icon {
            width: 40px; height: 40px;
            background: var(--green-dim); border: 1px solid var(--border);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
        }
        .logo-icon svg { width: 20px; height: 20px; stroke: var(--green-main); fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .logo-text { font-family: 'Syne', sans-serif; font-size: 1.2rem; font-weight: 700; }
        .logo-text span { color: var(--green-main); }

        .topbar-right { display: flex; align-items: center; gap: 16px; }
        .user-badge {
            display: flex; align-items: center; gap: 10px;
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 10px; padding: 7px 14px 7px 8px;
        }
        .avatar {
            width: 30px; height: 30px; border-radius: 8px;
            background: var(--green-dim); border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            font-family: 'Syne', sans-serif; font-size: 0.78rem; font-weight: 700; color: var(--green-main);
        }
        .user-name { font-size: 0.82rem; font-weight: 500; }
        .logout-btn {
            background: none; border: 1px solid var(--border); color: var(--text-muted);
            border-radius: 8px; padding: 7px 12px; font-family: 'DM Sans', sans-serif;
            font-size: 0.8rem; cursor: pointer; transition: border-color 0.2s, color 0.2s;
            display: flex; align-items: center; gap: 6px; text-decoration: none;
        }
        .logout-btn svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .logout-btn:hover { border-color: var(--red); color: var(--red); }

        /* Summary cards */
        .summary-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 32px; }
        .summary-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 16px; padding: 22px 20px; position: relative; overflow: hidden;
        }
        .summary-card .accent-dot {
            position: absolute; top: -20px; right: -20px;
            width: 80px; height: 80px; border-radius: 50%; opacity: 0.12;
        }
        .summary-card .card-label {
            font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.8px;
            color: var(--text-muted); font-weight: 500; margin-bottom: 10px;
            display: flex; align-items: center; gap: 8px;
        }
        .summary-card .card-label svg { width: 15px; height: 15px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .summary-card .card-value { font-family: 'Syne', sans-serif; font-size: 1.6rem; font-weight: 700; letter-spacing: -0.5px; }
        .summary-card .card-sub { font-size: 0.76rem; color: var(--text-muted); margin-top: 4px; }

        .sc-green .accent-dot { background: var(--green-main); }
        .sc-green .card-label { color: var(--green-main); }
        .sc-red .accent-dot { background: var(--red); }
        .sc-red .card-label { color: var(--red); }
        .sc-blue .accent-dot { background: var(--blue); }
        .sc-blue .card-label { color: var(--blue); }

        /* Section header */
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
        .section-header h2 { font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 700; }
        .add-btn {
            display: flex; align-items: center; gap: 7px;
            background: var(--green-dim); border: 1px solid var(--border); color: var(--green-main);
            border-radius: 10px; padding: 8px 16px; font-family: 'DM Sans', sans-serif;
            font-size: 0.82rem; font-weight: 500; cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s; text-decoration: none;
        }
        .add-btn svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 2.5; stroke-linecap: round; }
        .add-btn:hover { background: var(--green-glow); box-shadow: 0 2px 14px var(--green-dim); }

        /* Account list */
        .account-list { display: flex; flex-direction: column; gap: 10px; }
        .account-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 14px; padding: 18px 20px;
            display: flex; align-items: center; gap: 16px;
            transition: border-color 0.25s, box-shadow 0.25s;
            animation: slideUp 0.35s ease both;
        }
        .account-card:hover { border-color: rgba(62,207,142,0.4); box-shadow: 0 4px 20px rgba(0,0,0,0.25); }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(12px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .acct-icon {
            width: 44px; height: 44px; border-radius: 12px;
            background: var(--green-dim); color: var(--green-main);
            display: flex; align-items: center; justify-content: center;
            font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 700; flex-shrink: 0;
        }
        .acct-info { flex: 1; min-width: 0; }
        .acct-name { font-weight: 500; font-size: 0.92rem; margin-bottom: 3px; }
        .acct-date { font-size: 0.76rem; color: var(--text-muted); }
        .acct-balance { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 700; text-align: right; flex-shrink: 0; }
        .acct-balance.positive { color: var(--green-main); }
        .acct-balance.negative { color: var(--red); }
        .acct-balance.zero { color: var(--text-muted); }

        .acct-actions { display: flex; gap: 6px; flex-shrink: 0; }
        .icon-btn {
            width: 34px; height: 34px; border-radius: 8px;
            border: 1px solid var(--border); background: transparent; color: var(--text-muted);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: border-color 0.2s, color 0.2s, background 0.2s;
        }
        .icon-btn svg { width: 15px; height: 15px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .icon-btn:hover { border-color: var(--red); color: var(--red); background: var(--red-dim); }

        /* Empty state */
        .empty-state {
            text-align: center; padding: 52px 20px;
            background: var(--bg-card); border: 1px dashed var(--border); border-radius: 16px;
        }
        .empty-state .empty-icon {
            width: 56px; height: 56px; margin: 0 auto 16px;
            background: var(--green-dim); border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
        }
        .empty-state .empty-icon svg { width: 26px; height: 26px; stroke: var(--green-main); fill: none; stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }
        .empty-state h3 { font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 600; margin-bottom: 6px; }
        .empty-state p { color: var(--text-muted); font-size: 0.82rem; }

        /* Error banner */
        .error-banner {
            display: flex; align-items: center; gap: 10px;
            background: var(--red-dim); border: 1px solid var(--red);
            border-radius: 12px; padding: 14px 18px; margin-bottom: 20px;
        }
        .error-banner svg { width: 18px; height: 18px; stroke: var(--red); fill: none; stroke-width: 2; flex-shrink: 0; }
        .error-banner span { color: var(--red); font-size: 0.85rem; }

        .delete-form { margin: 0; }

        /* ========== MODAL ========== */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(4px);
            z-index: 100;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.25s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px 28px 28px;
            width: 90%;
            max-width: 420px;
            transform: translateY(16px) scale(0.97);
            transition: transform 0.3s cubic-bezier(.34,1.56,.64,1);
            position: relative;
        }
        .modal-overlay.active .modal { transform: translateY(0) scale(1); }

        .modal-close {
            position: absolute; top: 16px; right: 16px;
            width: 30px; height: 30px;
            border-radius: 8px; border: 1px solid var(--border);
            background: transparent; color: var(--text-muted);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: border-color 0.2s, color 0.2s;
        }
        .modal-close:hover { border-color: var(--red); color: var(--red); }
        .modal-close svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 2.5; stroke-linecap: round; }

        .modal h2 { font-family: 'Syne', sans-serif; font-size: 1.25rem; font-weight: 700; margin-bottom: 4px; }
        .modal .modal-sub { color: var(--text-muted); font-size: 0.82rem; margin-bottom: 24px; }

        /* Modal form fields */
        .m-field { margin-bottom: 16px; }
        .m-field label {
            display: block; font-size: 0.75rem; font-weight: 500;
            color: var(--text-muted); text-transform: uppercase;
            letter-spacing: 0.8px; margin-bottom: 7px;
        }
        .m-input-wrap { position: relative; }
        .m-input-wrap .m-icon {
            position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
            width: 17px; height: 17px;
            stroke: var(--text-muted); fill: none; stroke-width: 2;
            stroke-linecap: round; stroke-linejoin: round;
            pointer-events: none; z-index: 1; transition: stroke 0.3s;
        }
        .m-input-wrap input {
            width: 100%;
            padding: 12px 14px 12px 40px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 11px;
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .m-input-wrap input::placeholder { color: var(--text-muted); opacity: 0.6; }
        .m-input-wrap input:focus {
            border-color: var(--green-main);
            box-shadow: 0 0 0 3px var(--green-dim);
        }
        .m-input-wrap input:focus ~ .m-icon { stroke: var(--green-main); }

        /* Balance row: sign toggle + input side by side */
        .balance-row { display: flex; gap: 8px; }
        .sign-toggle {
            display: flex; border-radius: 11px; overflow: hidden;
            border: 1px solid var(--border); flex-shrink: 0;
        }
        .sign-btn {
            width: 38px; background: var(--bg-input); border: none;
            color: var(--text-muted); font-size: 1.1rem; cursor: pointer;
            transition: background 0.2s, color 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .sign-btn.active { background: var(--green-dim); color: var(--green-main); }
        .sign-btn.active.neg { background: var(--red-dim); color: var(--red); }
        .sign-btn:hover:not(.active) { background: rgba(255,255,255,0.04); }
        .balance-row .m-input-wrap { flex: 1; }

        .m-field-error { font-size: 0.73rem; color: var(--red); margin-top: 5px; opacity: 0; transition: opacity 0.2s; }
        .m-field.error .m-input-wrap input { border-color: var(--red); box-shadow: 0 0 0 3px var(--red-dim); }
        .m-field.error .m-field-error { opacity: 1; }

        .modal-submit {
            width: 100%; padding: 13px; margin-top: 6px;
            background: var(--green-main); color: #0a0f0d;
            border: none; border-radius: 11px;
            font-family: 'Syne', sans-serif; font-size: 0.9rem; font-weight: 700;
            cursor: pointer;
            transition: background 0.25s, box-shadow 0.25s, transform 0.15s;
        }
        .modal-submit:hover { background: #4fe8a0; box-shadow: 0 4px 20px var(--green-glow); }
        .modal-submit:active { transform: scale(0.97); }

        @media (max-width: 600px) {
            .summary-row { grid-template-columns: 1fr; }
            .account-card { flex-wrap: wrap; }
            .acct-balance { order: 2; flex-basis: calc(100% - 60px); margin-left: 60px; margin-top: -8px; }
        }
    </style>
</head>
<body>

<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>

<div class="page-wrap">

    <!-- Topbar -->
    <div class="topbar">
        <div class="logo-wrap">
            <div class="logo-icon">
                <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
            </div>
            <div class="logo-text">Franklin Fin<span>Track</span></div>
        </div>
        <div class="topbar-right">
            <div class="user-badge">
                <div class="avatar" th:text="${user.getUsername().substring(0,1).toUpperCase()}">U</div>
                <div class="user-name" th:text="${user.getUsername()}">User</div>
            </div>
            <a href="/user/login" class="logout-btn">
                <svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                Logout
            </a>
        </div>
    </div>

    <!-- Error banner -->
    <div th:if="${error}" class="error-banner">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        <span th:text="${error}">Error</span>
    </div>

    <!-- Summary Cards -->
    <!-- Controller passes: user, accounts, totalAssets, totalLiabilities, netWorth -->
    <div class="summary-row">

        <!-- Net Worth -->
        <div class="summary-card sc-green">
            <div class="accent-dot"></div>
            <div class="card-label">
                <svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                Net Worth
            </div>
            <div th:if="${netWorth.signum() >= 0}" class="card-value"
                 th:text="${'$' + #numbers.formatDecimal(netWorth, 1, 2)}">$0.00</div>
            <div th:if="${netWorth.signum() < 0}" class="card-value" style="color: var(--red);"
                 th:text="${'-$' + #numbers.formatDecimal(netWorth.abs(), 1, 2)}">$0.00</div>
            <div class="card-sub" th:text="${'across ' + accounts.size() + ' account' + (accounts.size() != 1 ? 's' : '')}">across 0 accounts</div>
        </div>

        <!-- Total Assets -->
        <div class="summary-card sc-blue">
            <div class="accent-dot"></div>
            <div class="card-label">
                <svg viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                Total Assets
            </div>
            <div class="card-value" th:text="${'$' + #numbers.formatDecimal(totalAssets, 1, 2)}">$0.00</div>
            <div class="card-sub">positive balances</div>
        </div>

        <!-- Total Liabilities -->
        <div class="summary-card sc-red">
            <div class="accent-dot"></div>
            <div class="card-label">
                <svg viewBox="0 0 24 24"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>
                Total Liabilities
            </div>
            <div class="card-value" th:text="${'$' + #numbers.formatDecimal(totalLiabilities.abs(), 1, 2)}">$0.00</div>
            <div class="card-sub">negative balances</div>
        </div>
    </div>

    <!-- Accounts Section Header -->
    <div class="section-header">
        <h2>My Accounts</h2>
        <button class="add-btn" onclick="openModal()">
            <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            New Account
        </button>
    </div>

    <!-- Account List -->
    <div class="account-list">

        <!-- Empty state -->
        <div th:if="${accounts.isEmpty()}" class="empty-state">
            <div class="empty-icon">
                <svg viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
            </div>
            <h3>No accounts yet</h3>
            <p>Tap "New Account" to add your first one</p>
        </div>

        <!-- Account cards -->
        <a th:each="account, iter : ${accounts}"
           th:href="@{/transaction/account/{id}(id=${account.getId()}, username=${user.getUsername()})}"
           style="text-decoration: none; color: inherit; display: block;">
            <div class="account-card"
                 th:style="${'animation-delay:' + (iter.index * 0.06) + 's'}">

                <div class="acct-icon" th:text="${account.getName().substring(0,1).toUpperCase()}">A</div>

                <div class="acct-info">
                    <div class="acct-name" th:text="${account.getName()}">Account Name</div>
                    <div class="acct-date" th:text="${'Opened ' + #temporals.format(account.getOpeningDate(), 'MMM d, yyyy')}">Opened Jan 1, 2025</div>
                </div>

                <!-- Positive current balance -->
                <div th:if="${accountBalances[account.id].signum() > 0}"
                     class="acct-balance positive"
                     th:text="${'$' + #numbers.formatDecimal(accountBalances[account.id], 1, 2)}">$0.00</div>

                <!-- Negative current balance -->
                <div th:if="${accountBalances[account.id].signum() < 0}"
                     class="acct-balance negative"
                     th:text="${'-$' + #numbers.formatDecimal(accountBalances[account.id].abs(), 1, 2)}">$0.00</div>

                <!-- Zero balance -->
                <div th:if="${accountBalances[account.id].signum() == 0}"
                     class="acct-balance zero">$0.00</div>

                <!-- Delete -->
                <div class="acct-actions">
                    <form th:action="@{/account/delete/{id}(id=${account.getId()})}" method="POST" class="delete-form">
                        <input type="hidden" name="username" th:value="${user.getUsername()}">
                        <button type="submit" class="icon-btn" title="Delete account"
                                onclick="return confirm('Remove this account?')">
                            <svg viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        </button>
                    </form>
                </div>
            </div>
        </a>
    </div>

</div>

<!-- ========== CREATE ACCOUNT MODAL ========== -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal">
        <button class="modal-close" onclick="closeModal()">
            <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
        <h2>New Account</h2>
        <p class="modal-sub">Add a checking, savings, loan, or credit card</p>

        <form th:action="@{/account/create}" method="POST" id="createAccountForm" novalidate>
            <!-- Hidden: pass username so controller can re-fetch User -->
            <input type="hidden" name="username" th:value="${user.getUsername()}">

            <!-- Name -->
            <div class="m-field" id="mf-name">
                <label>Account Name</label>
                <div class="m-input-wrap">
                    <input type="text" name="name" id="acctName" placeholder="e.g. Chase Checking" autocomplete="off">
                    <svg class="m-icon" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                </div>
                <div class="m-field-error">Account name is required</div>
            </div>

            <!-- Balance with +/- toggle -->
            <div class="m-field" id="mf-balance">
                <label>Opening Balance</label>
                <div class="balance-row">
                    <div class="sign-toggle">
                        <button type="button" class="sign-btn active" id="btnPos" onclick="setSign(true)">+</button>
                        <button type="button" class="sign-btn" id="btnNeg" onclick="setSign(false)">âˆ’</button>
                    </div>
                    <div class="m-input-wrap">
                        <input type="number" id="acctBalanceInput" placeholder="0.00" step="0.01" min="0" autocomplete="off">
                        <svg class="m-icon" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                    </div>
                </div>
                <!-- Hidden input holds the actual signed value sent to the server -->
                <input type="hidden" name="openingBalance" id="acctBalance">
                <div class="m-field-error">Please enter a valid balance</div>
            </div>

            <button type="submit" class="modal-submit">Create Account</button>
        </form>
    </div>
</div>

<script>
    let isPositive = true;

    // Modal open/close
    function openModal() {
        document.getElementById('modalOverlay').classList.add('active');
        document.getElementById('acctName').value = '';
        document.getElementById('acctBalanceInput').value = '';
        document.getElementById('acctBalance').value = '';
        setSign(true);
        clearModalErrors();
    }
    function closeModal() {
        document.getElementById('modalOverlay').classList.remove('active');
    }
    document.getElementById('modalOverlay').addEventListener('click', function(e) {
        if (e.target === this) closeModal();
    });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

    // Sign toggle
    function setSign(pos) {
        isPositive = pos;
        document.getElementById('btnPos').className = 'sign-btn' + (pos ? ' active' : '');
        document.getElementById('btnNeg').className = 'sign-btn' + (!pos ? ' active neg' : '');
    }

    // Validation helpers
    function showModalError(field) { document.getElementById('mf-' + field).classList.add('error'); }
    function clearModalErrors() {
        ['name', 'balance'].forEach(f => document.getElementById('mf-' + f).classList.remove('error'));
    }

    // Form submit: validate, set hidden balance, then POST
    document.getElementById('createAccountForm').addEventListener('submit', function(e) {
        clearModalErrors();
        let valid = true;

        const name = document.getElementById('acctName').value.trim();
        const balRaw = document.getElementById('acctBalanceInput').value.trim();

        if (!name) { showModalError('name'); valid = false; }
        if (balRaw === '' || isNaN(Number(balRaw)) || Number(balRaw) < 0) { showModalError('balance'); valid = false; }

        if (!valid) { e.preventDefault(); return; }

        // Write the signed value into the hidden input so it gets POSTed
        document.getElementById('acctBalance').value = isPositive ? balRaw : '-' + balRaw;
    });
</script>

</body>
</html>